<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ§® HyperCalc vLegendary â€“ Reality & AI Ultra Engine</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
body { display:flex; justify-content:center; align-items:center; min-height:100vh; background: linear-gradient(160deg,#0f172a,#1e293b); color: #e5e7eb; transition: background 0.5s ease; }
.app { width:100%; max-width:550px; background:#020617; border-radius:35px; padding:30px; box-shadow:0 30px 90px rgba(0,0,0,.9); backdrop-filter:blur(12px); transition: all 0.3s ease; }
header { text-align:center; margin-bottom:25px; }
header h1 { font-size:2rem; color:#fff; text-shadow: 0 0 12px #2563eb,0 0 24px #2563eb; }
header p { opacity:0.85; font-size:0.95rem; font-style:italic; text-shadow:0 0 6px #047857; }
.display { background:#020617; border:2px solid #334155; border-radius:22px; padding:20px; font-size:2rem; min-height:70px; text-align:left; margin-bottom:25px; box-shadow: inset 0 2px 12px rgba(255,255,255,0.05); overflow-wrap:break-word; transition:all 0.3s ease; }
.keys { display:grid; grid-template-columns:repeat(4,1fr); gap:14px; }
button { padding:18px; font-size:1.15rem; border:none; border-radius:15px; background:#1e293b; color:#e5e7eb; cursor:pointer; transition: all 0.2s ease; }
button:hover { background:#334155; transform: scale(1.08); }
button:active { transform: scale(0.95); }
.op { background:#334155; }
.equal { grid-column: span 2; background:#2563eb; color:#fff; box-shadow:0 0 16px #2563eb; }
.clear { background:#7f1d1d; color:#fff; }
.extra { background:#047857; color:#fff; box-shadow:0 0 12px #047857; }
canvas { margin-top:25px; border-radius:20px; border:2px solid #334155; width:100%; height:auto; background:#0f172a; box-shadow: inset 0 2px 15px rgba(255,255,255,0.05); cursor:crosshair; touch-action:none; transition: all 0.3s ease; }
.tooltip { font-size:0.75rem; color:#9ca3af; text-align:center; margin-top:8px; }
.history { margin-top:20px; background:#1e293b; padding:15px; border-radius:12px; max-height:200px; overflow-y:auto; font-size:0.8rem; color:#cbd5e1; }
</style>
</head>

<body>
<div class="app">
<header>
  <h1>ğŸ§® HyperCalc vLegendary</h1>
  <p>Ù†Ø³Ø®Ù‡ Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ â€“ Reality, Physics & AI Insights + AutoTrainer Ultra</p>
</header>

<div id="display" class="display">0</div>

<div class="keys">
  <button class="clear">C</button>
  <button class="op">Ã·</button>
  <button class="op">Ã—</button>
  <button class="op">âˆ’</button>

  <button>7</button><button>8</button><button>9</button>
  <button class="op">+</button>

  <button>4</button><button>5</button><button>6</button>
  <button>.</button>

  <button>1</button><button>2</button><button>3</button>
  <button class="equal">=</button>

  <button>0</button>
  <button class="extra" id="imgBtn">ğŸ“· Reality</button>
  <button class="extra" id="csvBtn">CSV</button>
  <button class="extra" id="pdfBtn">PDF</button>
</div>

<input type="file" id="fileInput" accept="image/*" hidden />
<canvas id="canvas" width="500" height="300"></canvas>
<div class="tooltip">ğŸ“Œ ØªÙ…Ø§Ù…ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§ØªØŒ ÙØ±Ù…ÙˆÙ„â€ŒÙ‡Ø§ØŒ Ù…Ø±Ø§Ø­Ù„ Ø­Ù„ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª AI Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</div>
<div class="history" id="history"></div>
</div>

<script type="module">
import { Sandbox } from './physics/sandbox.js';
import { HyperUltraPhysicsBody } from './physics/body.js';
import { EngineV3 } from './core/engine.v3.js';
import { AutoTrainer } from './auto_trainer.js';
import { GeometryEngine3D } from './geometry.js';

// ======================
// Init Sandbox & Physics
// ======================
const sandbox = new Sandbox({ gravity: 9.81 });
const ball = new HyperUltraPhysicsBody({ mass: 5, radius: 15, position:{x:150,y:50,z:0} });
sandbox.world.addBody(ball);
sandbox.update(1/60);

// ======================
// Init Geometry Engine
// ======================
const geo = new GeometryEngine3D({ canvasId:'canvas' });
geo.circle(20,{x:200,y:100});
geo.rectangle(60,30,{x:100,y:200});
geo.cube(25,{x:300,y:150,z:0});
geo.drawShapes();

// ======================
// Display & Input
// ======================
const display = document.getElementById('display');
const historyDiv = document.getElementById('history');
let currentInput = '';
document.addEventListener('keydown', e=>{
  if(!isNaN(e.key)) { currentInput += e.key; display.textContent = currentInput; }
  else if(e.key==='Enter') computeResult();
  else if(e.key==='Backspace') { currentInput=currentInput.slice(0,-1); display.textContent=currentInput||'0'; }
});
document.querySelectorAll('.keys button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const val = btn.textContent;
    if(val==='C') { currentInput=''; display.textContent='0'; }
    else if(val==='=') computeResult();
    else currentInput+=val, display.textContent=currentInput;
  });
});

// ======================
// Compute + AutoTrainer + HyperCalc Legendary AI
// ======================
function computeResult(){
  try{
    const res = eval(currentInput.replace('Ã—','*').replace('Ã·','/'));
    display.textContent=res;

    const timestamp = new Date().toLocaleTimeString();
    const hItem = document.createElement('div');
    hItem.textContent=`[${timestamp}] ${currentInput} = ${res}`;
    historyDiv.prepend(hItem);

    // ğŸŒŸ AutoTrainer Suggestions
    const suggestions = AutoTrainer.suggest(currentInput);
    suggestions.forEach(s=>{
      const sItem = document.createElement('div'); sItem.style.color='#facc15';
      sItem.textContent=s.hint || s;
      historyDiv.prepend(sItem);
    });

    // Physics & Geometry Update
    sandbox.update(1/60);
    geo.drawShapes();

    currentInput='';
  }catch(e){ display.textContent='Error'; console.error(e);}
}

// ======================
// Reality / CSV / PDF
// ======================
document.getElementById('imgBtn').onclick = ()=> document.getElementById('fileInput').click();
document.getElementById('fileInput').addEventListener('change', e=>{
  const file=e.target.files[0]; if(!file) return;
  console.log('ğŸ“· Image loaded for Reality Analysis:', file.name);
});
document.getElementById('csvBtn').onclick = ()=> alert('ğŸ“Š Export CSV â€“ Ø¢Ù…Ø§Ø¯Ù‡');
document.getElementById('pdfBtn').onclick = ()=> alert('ğŸ“„ Export PDF â€“ Ø¢Ù…Ø§Ø¯Ù‡');

// ======================
// Service Worker
// ======================
if('serviceWorker' in navigator){ window.addEventListener('load',()=>{ navigator.serviceWorker.register('sw.js'); }); }

</script>
</body>
</html>
